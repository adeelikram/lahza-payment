var __awaiter=this&&this.__awaiter||function(e,i,c,d){return new(c=c||Promise)(function(n,r){function t(e){try{o(d.next(e))}catch(e){r(e)}}function a(e){try{o(d.throw(e))}catch(e){r(e)}}function o(e){var r;e.done?n(e.value):((r=e.value)instanceof c?r:new c(function(e){e(r)})).then(t,a)}o((d=d.apply(e,i||[])).next())})};function getSuccessContent(){var{currency:e,amount:r,name:n}=customer,n=`
    <img src="assets/tick.PNG" alt="" class="d-block mx-auto mt-5 mb-2">
    <div class="text-white h1 text-center">Payment Successful</div>
    <div class="text-center text-white h6 mb-5">You have paid ${r} ${e} to ${n}</div>
    `;parent.postMessage("success","*"),hideShowEl(".accordion-header",null);var t=Array.from(document.querySelectorAll(".accordion-item"));for(let e=1;e<t.length;e++)t[e].style.border="none";return setTimeout(()=>{parent.postMessage("closenow","*")},3e3),n}function getError(e,r){let n=[];var t="",a="";return"USSD"==e&&"QR"==r?n=["#card-error","#before-payment-card","headingTwo","headingThree"]:"Card"==e&&"USSD"==r?n=["#qr-error","#before-payment-qr","headingOne","headingTwo"]:"QR"==e&&"Card"==r&&(n=["#ussd-error","#before-payment-ussd","headingThree","headingOne"]),`
    <img src="assets/warning.png" class="d-block mx-auto my-3" alt="">
    <div class="h4 text-white text-center">The transaction was not completed</div>
    ${t=customer.channels.includes(e.toLowerCase())?`<button onclick="document.getElementById('${n[2]}').children[0].click()" class="btn col-md-6 offset-md-3 bg-light my-1 col-10 offset-1 fw-bold">
                        Try paying with ${e} 
                        </button>`:t}
    ${a=customer.channels.includes(r.toLowerCase())?`<button onclick="document.getElementById('${n[3]}').children[0].click()" class="btn col-md-6 offset-md-3 bg-light my-1 col-10 offset-1 fw-bold">
                        Try paying with ${r} 
                        </button>`:a}
    <a href="#" onclick="hideShowEl('${n[0]}','${n[1]}')" class="col-4 d-block mx-auto text-center text-decoration-none">&#8635; Try again</a>
    `}function getCurrNameAmount(){var{currency:e,amount:r,name:n}=customer;return`
    <span>${e}</span> <span>${r}
         <div class="name-text">${n}</div>
    </span>
    `}function checker(o){var i;return __awaiter(this,void 0,void 0,function*(){for(var e=document.querySelectorAll(".accordion-item"),r=Array.from(e),n=1;n<r.length;n++)r[n].children[0].id==o.id?o.style.display="none":r[n].children[0].style.display="block";if(1<r.length&&((a=document.querySelector("#popup")).insertBefore(o.parentNode,a.children[1]),("headingThree"==(null===(i=a.children[2])||void 0===i?void 0:i.children[0].id)&&4==a.children.length||"headingOne"==(null===(i=a.children[3])||void 0===i?void 0:i.children[0].id))&&a.insertBefore(a.children[3],a.children[2])),o.innerHTML.includes("QR")&&!document.querySelector("#before-payment-qr").hidden){hideShowEl(null,".spinbuldak");try{var t=yield axios.post(`${url}/generate`,{transaction:Number(transaction)},{headers:{accept:"application/json"}})}catch(e){return void apiFailure()}hideShowEl(".spinbuldak",null);var a=document.querySelector("#intializeQR");a.innerHTML="",a.innerHTML=renderQRImg(t.data.data.url)}})}function chargeCard(n){return __awaiter(this,void 0,void 0,function*(){if(n){n.preventDefault(),n.target.disabled=!0,hideShowEl("#before-payment-card",null),hideShowEl(null,".spinbuldak");var e=document.querySelectorAll("#validTill, #cvv, #cardno");try{var r=yield axios.post(`${url}/charge`,{card:e[0].value.replace(/\s/g,""),expiry:e[1].value,cvv:e[2].value})}catch(e){return void apiFailure()}hideShowEl(".spinbuldak",null),"success"==r.data.status?"link"in r.data?(hideShowEl("#before-payment-card, #card-error, #card-success-ms","#card-auth"),customer.cardAuthLink=r.data.link):(hideShowEl("#before-payment-card, #card-error, #card-auth",null),Object.assign(document.querySelector("#card-success-ms"),{hidden:!1},{innerHTML:getSuccessContent()}),console.log(r.data)):(hideShowEl("#before-payment-card, #card-success-ms, #card-auth",null),Object.assign(document.querySelector("#card-error"),{hidden:!1},{innerHTML:getError("USSD","QR")}))}})}function openIframe(){parent.postMessage(JSON.stringify({iframe:{url:customer.cardAuthLink}}),"*")}function chooseBank(r){return __awaiter(this,void 0,void 0,function*(){hideShowEl("#banks",".spinbuldak");try{var e=yield axios.post(`${url}/reference`,{transaction:Number(transaction),channel:Number(r)})}catch(e){return void apiFailure()}hideShowEl(".spinbuldak",null),console.log(e.data.data),Object.assign(document.querySelector("#choosenBank"),{hidden:!1},{innerHTML:renderChosenBank(r,e.data.data.code)})})}function banks(){document.getElementById("copied-code").innerHTML="click here to copy",hideShowEl("#choosenBank","#banks")}function copy(e,r){return __awaiter(this,void 0,void 0,function*(){yield navigator.clipboard.writeText(`${r}`),e.innerHTML="Copied!"})}function tranSuccess(r){return __awaiter(this,void 0,void 0,function*(){hideShowEl(null,".spinbuldak"),hideShowEl(`#before-payment-${r}`,null);try{var e=yield axios.post(`${url}/reference_query`,{reference:transaction})}catch(e){return void apiFailure()}hideShowEl(".spinbuldak",null),console.log("transaction id:",transaction),console.log(e.data),"success"==e.data.status||"1"==e.data.status||1==e.data.status||"true"==e.data.status?(hideShowEl(`#before-payment-${r}, #${r}-error`,null),Object.assign(document.querySelector(`#${r}-success-ms`),{hidden:!1},{innerHTML:getSuccessContent()})):(hideShowEl(`#before-payment-${r}, #chosenBank`,null),Object.assign(document.querySelector(`#${r}-error`),{hidden:!1},{innerHTML:"card"==r?getError("USSD","QR"):"ussd"==r?getError("QR","Card"):getError("Card","USSD")}))})}function hideShowEl(e,r){var n;for(n of Array.from(document.querySelectorAll(e)))n.hidden=!0;for(n of Array.from(document.querySelectorAll(r)))n.hidden=!1}function apiFailure(){var e=document.querySelector("#popup");hideShowEl(".spinbuldak",null);for(var r=Array.from(e.querySelectorAll(".accordion-item")),n=1;n<r.length;n++)r[n].hidden=!0;e.innerHTML+=renderError()}